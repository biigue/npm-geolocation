
class GeolocationPhone{constructor(url,brand){this.API_URL=url;this.BRAND=brand;this.getInfos();}
get brand(){return this.BRAND;}
get whatsapp(){return this.WHATSAPP;}
get geolocation(){return this.GEOLOCATION;}
get location(){return this.GEOLOCATION.location;}
transform(phone){let formated='';if(phone){formated=phone.length>11?phone.slice(phone.length>13?4:2):phone;formated=`(${formated.slice(0, 2)}) ${formated.slice(2, 6)}-${formated.slice(6)}`;}
return formated;}
getLocation(){return new Promise(function(resolve){if('geolocation'in navigator){navigator.geolocation.getCurrentPosition(position=>{const{latitude,longitude}=position.coords;resolve({lat:latitude,lng:longitude});});}else{resolve(false);}});}
setInfos(infos){const{hash}=window.location;const campanha=hash.includes('utm');this.WHATSAPP=infos.whatsapp;this.LOCATION=infos.location;this.GEOLOCATION=infos.geolocation;$('.formated_phone').text(this.transform(infos[campanha?'phone_track':'phone']));$('.link_phone').attr('href','tel:'+infos[campanha?'phone_track':'phone']);}
getInfos(){this.getLocation().then(position=>{const body={...position,brand:this.BRAND.toLowerCase()};fetch(this.API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}).then(response=>response.json()).then(infos=>this.setInfos(infos)).catch(function(err){console.error(err);});});}}